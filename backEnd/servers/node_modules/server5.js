//var express=require("express");
//var bounty=require("./app.js");
//var bodyParser=require("body-parser");
//var app=express();
//var bodyParser=require("body-parser");
//app.use (bodyParser.urlencoded({extended:false}));
//app.use(bodyParser.json());
//var port=process.env.Port||8080;
//
//app.get("/bounty",function(req,res){
//    res.status(200).send((bounty))
//});
//app.post("/bounty",function(req,res){
//    res.send(200).send({"massege":"Hello Miro Welcome"})
//});
//app.listen(port,function(){
//    console.log("your port is"+port);
//});
var express = require("express");
var bodyParser = require("body-parser");
var uuid = require("uuid");
var validate = require("./validate.js")
var bounty = require("./app.js");
//setup for server
var app = express();
var PORT = process.env.Port || 8080;
//setup to handle json
app.use(bodyParser.urlencoded({
    extended: false
}));
app.use(bodyParser.json());

app.get("/bounty", function (req, res) {
    if (Object.keys(req.query).length == 0) {
        res.status(200).send(bounty)
    } else {
        var filerData = [];
        var query = req.query;

        for (key in query) {
            for (var i = 0; i < bounty.length; i++) {
                if (bounty[i][key] == query[key]) {
                    filerData.push(bounty[i]);
                   
                }
            }
        }
       

    }
 res.status(200).send(filerData)
});
app.post("/bounty", function (req, res) {
    var didPass = validate(data);
    if (didPass.pass == false) {
        res.status(400).send({
            message: "didPasss.failure"
        })
    } else {
        bounty.push(req.body);
        res.status(200).send({
            "message": "success"
        })
    };
});
app.delete("/bounty/:id", function (req, res) {
    var id = req.params.id;
    for (var i = 0; i < bounty.length; i++) {
        if (id == bounty[i].id) {
            bounty.splice(i, 1)
            res.status(200).send({
                "message": "you have delete the item with id " + id
            });
        }
    }
    res.status(404)({
        "message": "no such as id  " + id
    })
});
app.put("/bounty/:id", function (req, res) {
    var id = req.params.id;
    var bounties = req.query;
    for (var i = 0; i < bounty.length; i++) {
        if (id == bounty[i].id) {
            for (key in bounties) {
                if (bounty[i][key] == undefined) {
                    res.status(400).send({
                        message: "no such key" + key
                    })
                } else {
                    bounty[i][key] = bounties[key];
                    
                }

            }
            res.status(200).send({
                        "message": "updated" + id
                    }); //like break;
        }

    }
    res.status(404).send({
        "message": "no such as id  " + id
    })
});
app.listen(PORT, function () {
    console.log("you are runinng port :" + PORT);
});